#!/bin/bash -e
PROJECT=$1
BRANCH=$2

# Main code
. /opt/pg/env/alps.bashrc

cd ~/work/pg_ui/build
if [[ $PROJECT == "pg_ui" && $BRANCH != "grunt" ]]; then
  make -j 4 install
fi
cd ~/work/sal/build
make -j 4 install
cd ~/work/pkg/build
make -j 4 install
cd ~/work/pg_cli/build
make -j 4 install
cd ~/work/python-plumgridlib/build
make -j 4 install
cd ~/work/python-plumgridlib/lib
sudo python setup.py install
cd ~/work/gcloud/build/aurora/init_scripts
./nirvana_build.sh --block_alps
cd ~/work/corelib/build
make -j 4 install
cd ~/work/alps/build
for i in `seq 1 4`; do
  return_value=0
  make -k -j 4 install || return_value=$?
  [[ $return_value -eq 0 ]] && break
done
#Need to have the last command status for run_bg_cmd
[[ $return_value -eq 0  ]]